{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-12">
    <h2 class="mb-3">Your Cart</h2>

    {% if messages %}
      {% for m in messages %}
        <div class="alert alert-{{ m.tags|default:'info' }}">{{ m }}</div>
      {% endfor %}
    {% endif %}
  </div>
</div>

{% if cart_items %}
  <div class="card mb-4">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Product</th>
            <th class="text-end" style="width:110px;">Price</th>
            <th class="text-center" style="width:140px;">Quantity</th>
            <th class="text-end" style="width:130px;">Subtotal</th>
            <th style="width:90px;"></th>
          </tr>
        </thead>
        <tbody>
          {% for item in cart_items %}
          <tr>
            <td>
              <div class="d-flex align-items-center">
                <a href="{% url 'market:product_detail' slug=item.product.slug %}" class="d-flex align-items-center text-decoration-none">
                  <img src="{{ item.product.primary_image_url }}" alt="{{ item.product.title }}" class="rounded me-3" style="width:72px; height:64px; object-fit:cover;">
                  <div class="text-body">
                    <div class="fw-semibold">{{ item.product.title|truncatechars:70 }}</div>
                    <div class="small text-muted">{{ item.product.get_category_display }}</div>
                  </div>
                </a>
              </div>
            </td>

            <td class="text-end">₹ {{ item.product.price }}</td>

            <td class="text-center">
              <form method="post" action="{% url 'market:update_cart' %}" class="d-flex justify-content-center align-items-center">
                {% csrf_token %}
                <input type="hidden" name="item_id" value="{{ item.id }}">
                <input type="number" name="qty" value="{{ item.qty }}" min="1" max="{{ item.product.quantity }}" class="form-control form-control-sm me-2" style="width:90px;">
                <button type="submit" class="btn btn-outline-secondary btn-sm">Update</button>
              </form>
            </td>

            <td class="text-end fw-semibold">₹ {{ item.subtotal }}</td>

            <td class="text-end">
              <form method="post" action="{% url 'market:remove_from_cart' %}">
                {% csrf_token %}
                <input type="hidden" name="item_id" value="{{ item.id }}">
                <button type="submit" class="btn btn-outline-danger btn-sm">Remove</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Summary & actions -->
  <div class="row">
    <div class="col-md-6 mb-3">
      <a href="{% url 'market:product_list' %}" class="btn btn-link">← Continue shopping</a>
    </div>

    <div class="col-md-6">
      <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="small text-muted">Subtotal</div>
          <div class="fs-5 fw-bold">₹ {{ cart_total }}</div>
        </div>

        <!-- Optional: estimated shipping / taxes placeholders -->
        <div class="small text-muted mb-3">Shipping & taxes calculated at checkout.</div>

        <div class="d-flex gap-2">
          <a href="{% url 'market:product_list' %}" class="btn btn-outline-secondary w-50">Continue shopping</a>

          <form method="post" action="{% url 'market:checkout' %}" class="w-50">
            {% csrf_token %}
            <button type="submit" class="btn btn-success w-100">Checkout</button>
          </form>
        </div>
      </div>
    </div>
  </div>

{% else %}
  <div class="card text-center py-5">
    <div class="card-body">
      <h5 class="card-title">Your cart is empty</h5>
      <p class="card-text text-muted mb-4">Looks like you haven't added any items yet.</p>
      <a href="{% url 'market:product_list' %}" class="btn btn-primary">Browse products</a>
    </div>
  </div>
{% endif %}

<!-- Small page-specific styles -->
<style>
  /* Make table cells vertically aligned centrally and compact on small screens */
  @media (max-width: 767.98px) {
    table.table img { width: 56px; height: 48px; }
    .table thead { display: none; }
    .table tbody tr { display: block; margin-bottom: 1rem; border: 1px solid rgba(15,118,110,0.04); border-radius: 8px; padding: 0.75rem; background: #fff; }
    .table tbody td { display: block; width: 100%; padding: .25rem 0; }
    .table tbody td .form-control { width: 100%; }
    .table tbody td .btn { width: 100%; }
  }
</style>
{% endblock %}
